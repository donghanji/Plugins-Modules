/*
   module.js ,version 1.2.1 ,updated on 2014-01-13
   module for Plugins Modules library.

   https://github.com/donghanji/pm
 */

"use strict";!function(a,b){var c=a.document,d=a.location.pathname,e={},f=Object.prototype.toString,g={options:{require:!1,nocache:!1,debug:!1,timeout:7e3,mined:"",base:"",dirs:{},alias:{},files:[],coms:{},defaults:{},globals:{}},util:{},path:{}},h={SLASHDIR:/^\//,BASEDIR:/.*(?=\/.*$)/,JSSUFFIX:/\.js$/,COMMENT:/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,REQUIRE:/(?:^|[^.$])\brequire\s*\(\s*(["'])([^"'\s\)]+)\1\s*\)/g,REQUIRE_FUN:/^function \(\w*\)/,MODULENAME:/\/([\w.]+)?(?:\1)?$/,PLACEHOLDER_DIR:/\{(\S+)?\}(?:\1)?/},i={ERROR:-1,BEGIN:0,LOADING:1,LOADED:2,END:3};!function(a){a.extend=function(){var a,b=arguments[0]||{},c=arguments.length,d=1;for(c===d&&(b=this,--d);c>d;d++)if(a=arguments[d],"object"==typeof a)for(var e in a)b[e]=a[e];return b},a.extend({type:function(a){return null==a?String(a):e[f.call(a)]||"object"},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},isString:function(b){return"string"===a.type(b)},isFunction:function(b){return"function"===a.type(b)},isObject:function(b){return"object"===a.type(b)},isArray:function(b){return"array"===a.type(b)}}),a.now=function(){return(new Date).getTime()},a.uid=function(){return a.now()+""+Math.floor(1e6*Math.random())},a.isEmpty=function(c){return""===c||c===b||null===c?!0:a.isArray(c)?c.length?!1:!0:a.isObject(c)?a.isEmptyObject(c):!1},a.isEmptyObject=function(a){for(var b in a)return!1;return!0},a.each=function(c,d){var e=0,f=c.length,g=f===b||a.isFunction(c);if(g){for(var h in c)if(d.call(c[h],h,c[h])===!1)break}else for(;f>e&&d.call(c[e],e,c[e++])!==!1;);},a.each("Boolean,Number,String,Function,Array,Date,RegExp,Object".split(","),function(a,b){e["[object "+b+"]"]=b.toLowerCase()}),a.keys=Object.keys||function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b},a.unique=function(b){var c={};return a.each(b,function(a,b){c[b]=1}),a.keys(c)},a.isInArray=function(b,c){if(!a.isArray(b))return!1;for(var d=0,e=b.length;e>d;d++)if(b[d]===c)return!0;return!1},a.parseDependencies=function(b){b=b.replace(h.COMMENT,"");var c,d=[],e=h.REQUIRE;for(e.lastIndex=0;c=e.exec(b);)c[2]&&d.push(c[2]);return a.unique(d)},a.path2name=function(b){if(a.isArray(b)){var c=[];return a.each(b,function(b,d){d=a.path2name(d),c.push(d)}),c}var d=h.MODULENAME,e=d.exec(b);return e&&e.length>1&&(b=e[1].replace(h.JSSUFFIX,"")),b}}(g.util),function(a){a.dirname=function(a){var b=a.match(h.BASEDIR);return(b?b[0]:".")+"/"},a.realpath=function(a){var b=g.options.base;return-1===a.indexOf("//")&&(a=b+a),a}}(g.path),function(){var a=g.path,b=g.options,c=a.dirname(d);b.base=c}(g.options);var j={},k=[],l={};!function(){var d=g.options,e=g.util,f=g.path;g.dirs=function(a){a=e.isObject(a)?a:{};var b=d.dirs,c=h.PLACEHOLDER_DIR;for(var f in a){var g=c.exec(a[f]),i=a[f];if(g&&g.length>1){var j=b[g[1]]||g[1]||"";i=i.replace(g[0],j)}a[f]=i}return a},g.init=function(b){b=e.isObject(b)?b:{},d=e.extend(d,b),d.alias=g.dirs(d.alias);var c=d.mined,f=/^\./;c=c&&!f.test(c)?"."+c:c,d.mined=c,d.require===!0&&(a.require=g.declare,a.define=g.declare,a.define.remove=g.remove),d.debug===!0&&(g.ModulesSet=j,g.ModuleCachesQueue=k,g.StatusCacheQueue=l,a.module=g,a.module.config=g.init)},g.alias=function(a){return e.isEmpty(a)?d.alias:(a=e.isObject(a)?a:{},a=g.dirs(a),d.alias=e.extend(a,d.alias),void 0)},g.files=function(a){if(e.isEmpty(a))return d.files;if(e.isString(a)&&(a=[].concat(a)),e.isObject(a)){var b=[];e.each(a,function(a){b.push(a)}),g.alias(a),a=b}d.files=e.unique(d.files.concat(a))},g.globals=function(a){return e.isEmpty(a)?d.globals:e.isString(a)?d.globals[a]||"":(a=e.isObject(a)?a:{},d.globals=e.extend(a,d.globals),void 0)},g.defaults=function(a,c){if(e.isEmpty(a))return d.defaults;if(e.isObject(a))for(var f in a)g.defaults(f,a[f]);else{if(a=g.aliasId(a),c===b)return d.defaults[a]||{};c=e.isObject(c)?c:{},d.defaults[a]=d.defaults[a]||{},d.defaults[a]=e.extend(c,d.defaults[a])}},g.scripts=function(){return c.getElementsByTagName("script")},g.createScript=function(a,d){d=d===b||d?!0:!1;var e=c.createElement("script");return e.setAttribute("data-requiremodule",a),e.type="text/javascript",e.charset="utf-8",e.async=d,e},g.getScriptData=function(a){var b=a.currentTarget||a.srcElement;return b.detachEvent?(b&&b.detachEvent("onreadystatechange",g.onScriptLoad),b&&b.detachEvent("error",g.onScriptError)):(b&&b.removeEventListener("load",g.onScriptLoad,!1),b&&b.removeEventListener("error",g.onScriptError,!1)),{node:b,id:b&&b.getAttribute("data-requiremodule")}},g.loadJS=function(a){var b=g.isInComs(a);if(a=null!==b?b:a,!(g.getStatus(a)>i.BEGIN)){g.statusSet(a,i.LOADING);var j=c.getElementsByTagName("head")[0],k=g.createScript(a),l=g.aliasId(a,"v"),m=f.realpath(l);m+=d.mined,h.JSSUFFIX.test(m)||(m+=".js"),d.nocache&&(m=m+"?t="+e.now()),k.src=m,j.appendChild(k),k.attachEvent?(k.attachEvent("onreadystatechange",g.onScriptLoad),k.attachEvent("onerror",g.onScriptError)):(k.addEventListener("load",g.onScriptLoad,!1),k.addEventListener("error",g.onScriptError,!1))}},g.removeJS=function(a){a=g.aliasId(a),e.each(g.scripts(),function(b,c){return c&&c.getAttribute("data-requiremodule")===a?(c.parentNode.removeChild(c),!0):void 0})},g.onScriptLoad=function(a){var b=a.currentTarget||a.srcElement;if("load"===a.type||"readystatechange"===a.type&&("loaded"===b.readyState||"complete"===b.readyState)){var c=g.getScriptData(a),d=c.id;g.statusSet(d,i.LOADED),g.isInFiles(d)&&(g.compile(d),g.complete(d,[],function(){return{}}))}},g.onScriptError=function(a){var b=g.getScriptData(a),c=b.id;g.statusSet(c,i.ERROR),g.compile(c),g.removeJS(c)},g.statusSet=function(a,b){a=g.aliasId(a),l[a]||(l[a]={}),l[a].status=b},g.getStatus=function(a){return a=g.aliasId(a),l[a]&&l[a].status||i.BEGIN},g.load=function(a){e.each(a,function(a,b){g.loadJS(b)})},g.isInAlias=function(a){var b=d.alias;for(var c in b){var f=e.path2name(b[c]);if(c===a||f===a||b[c]===a)return{k:c,v:b[c]}}return null},g.aliasId=function(a,b){b=b||"k";var c=g.isInAlias(a);return a=c&&c[b]||a},g.isInFiles=function(a){var b=d.files,c=0,e=b.length;for(a=g.aliasId(a);e>c;c++)if(b[c]===a)return!0;return!1},g.isInComs=function(a){var b=d.coms,c=g.aliasId(a),f=g.aliasId(a,"v");for(var h in b)if(c===h||e.isInArray(b[h],c)||e.isInArray(b[h],f))return h;return null},g.isInModules=function(a){return a=g.aliasId(a),j[a]},g.noInModulesItems=function(a){var b=[];return e.each(a,function(a,c){g.isInModules(c)||b.push(c)}),b},g.isRequire=function(a){return a?h.REQUIRE_FUN.test(a):!1},g.moduleSet=function(a,b,c){if(a=g.aliasId(a),g.isInModules(a)&&e.isFunction(c)){if(g.isRequire(c.toString()))return c(this.declare),void 0;throw'module "'+a+'" already defined!'}e.isFunction(c)&&(j[a]={id:a,dependencies:b,factory:c})},g.compile=function(a){a=g.aliasId(a);var b=g.aliasId(a,"v");e.each(k,function(c,d){function f(){for(var b=0,c=h.length;c>b;b++)if(h[b]===a)return h.splice(b,1),g.compile(a),void 0}if(d){var h=d.links||[];if(e.isInArray(h,a)||e.isInArray(h,b)){if(h.length<=1){var i=d.id||e.uid(),l=d.dependencies||[],m=d.factory||"",n=j[a]||{},o=n.dependencies||[];l=l.concat(o),l=e.unique(l),k.splice(c,1),g.complete(i,l,m)}f()}}})},g.complete=function(a,b,c){g.moduleSet(a,b,c);var d=g.exports(a);return g.compile(a),d},g.build=function(a){var b=a.factory;a.exports={},delete a.factory;var c=b(this.declare,a.exports,a);return e.isEmptyObject(a.exports)&&(a.exports=c||{}),a.exports},g.exports=function(a){if(g.isInModules(a)){a=g.aliasId(a);var b=j[a].factory?g.build(j[a]):j[a].exports;return b}return null},g.declare=function(a,b,c){b=b||[],e.isArray(a)&&(c=b,b=a,a=""),e.isFunction(b)&&(c=b,b=[]),e.isFunction(a)&&(c=a,b=e.parseDependencies(c.toString())||[],a=""),a=a||e.uid();var d=g.noInModulesItems(b);if(d&&d.length){var f={id:a,dependencies:b,factory:c,links:e.path2name(d)};return k.push(f),g.load(b),void 0}return g.complete(a,b,c)},g.remove=function(a){a=g.aliasId(a),a&&(g.removeJS(a),delete l[a],delete j[a])}}(),a.module=a.module||{},a.module.config=g.init,a.module.alias=g.alias,a.module.files=g.files,a.module.globals=g.globals,a.module.defaults=g.defaults,a.module.declare=g.declare,a.module.conflict=function(){a._module=a.module,a._require=a.require,a._define=a.define,delete a.module,delete a.require,delete a.define,a._module.conflict=function(){delete a._module.conflict,a.module=a._module,a.require=a._require,a.define=a._define,delete a._module,delete a._require,delete a._defined}}}(window);